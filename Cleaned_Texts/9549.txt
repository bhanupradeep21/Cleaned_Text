bioinformatics neighbor joining bottomup agglomerative clustering method creation phylogenetic trees created naruya saitou masatoshi nei usually based dna protein sequence data algorithm requires knowledge distance pair taxa eg species sequences create phylogenetic neighbor joining takes distance matrix specifies distance pair taxa input algorithm starts completely unresolved tree whose topology corresponds star network iterates following steps tree completely resolved branch lengths known based distance matrix relating n displaystyle n taxa calculate n displaystyle n x n displaystyle n matrix q displaystyle q follows j displaystyle dij distance taxa displaystyle j displaystyle j taxa pair joined use following formula calculate distance new node taxa f displaystyle f g displaystyle g paired taxa u displaystyle u newly created node branches joining f displaystyle f u displaystyle u g displaystyle g u displaystyle u lengths δ f u displaystyle delta fu δ g u displaystyle delta gu part tree gradually created neither affect affected later neighborjoining steps taxon considered previous step calculate distance new node follows u displaystyle u new node k displaystyle k node want calculate distance f displaystyle f g displaystyle g members pair joined neighbor joining set n displaystyle n taxa requires n displaystyle iterations step one build search q displaystyle q matrix initially q displaystyle q matrix size n n displaystyle ntimes n next step n n displaystyle etc implementing straightforward way leads algorithm time complexity n displaystyle implementations exist use heuristics much better let us assume five taxa b c e displaystyle abcde following distance matrix displaystyle calculate q displaystyle values equation example obtain following values q displaystyle matrix diagonal elements matrix used omitted example q b displaystyle smallest value q displaystyle join elements displaystyle b displaystyle b let u displaystyle u denote new node equation branches joining displaystyle b displaystyle b u displaystyle u lengths proceed update initial distance matrix displaystyle new distance matrix displaystyle see reduced size one row one column joining displaystyle b displaystyle b neighbor u displaystyle u using equation compute distance u displaystyle u nodes besides displaystyle b displaystyle b case obtain resulting distance matrix displaystyle bold values displaystyle correspond newly calculated distances whereas italicized values affected matrix update correspond distances elements involved first joining taxa corresponding q displaystyle matrix may choose either join u displaystyle u c displaystyle c join displaystyle e displaystyle e pairs minimal q displaystyle value displaystyle either choice leads result concreteness let us join u displaystyle u c displaystyle c call new node v displaystyle v lengths branches joining u displaystyle u c displaystyle c v displaystyle v calculated joining elements branch length calculation help drawing neighbor joining tree shown figure updated distance matrix displaystyle remaining nodes v displaystyle v displaystyle e displaystyle e computed tree topology fully resolved point however clarity calculate q displaystyle matrix example concreteness let us join v displaystyle v displaystyle call last node w displaystyle w lengths three remaining branches calculated neighbor joining tree complete shown figure example represents idealized case note move taxon along branches tree sum lengths branches traversed result equal distance taxa input distance matrix example going displaystyle b displaystyle b displaystyle distance matrix whose distances agree way tree said additive property rare practice nonetheless important note given additive distance matrix input neighbor joining guaranteed find tree whose distances taxa agree neighbor joining may viewed greedy heuristic balanced minimum bme criterion topology bme defines tree length sum branch lengths particular weighted sum distances distance matrix weights depending topology bme optimal topology one minimizes tree length neighbor joining step greedily joins pair taxa give greatest decrease estimated tree length procedure guarantee find optimum bme criterion although often usually quite close main virtue nj compared least squares maximum parsimony maximum likelihood makes practical analyzing large data sets hundreds thousands taxa bootstrapping purposes means analysis eg maximum parsimony maximum likelihood may computationally prohibitive neighbor joining property input distance matrix correct output tree correct furthermore correctness output tree topology guaranteed long distance matrix nearly additive specifically entry distance matrix differs true distance less half shortest branch length practice distance matrix rarely satisfies condition neighbor joining often constructs correct tree topology correctness neighbor joining nearly additive distance matrices implies statistically consistent many models evolution given data sufficient length neighbor joining reconstruct true tree high probability compared upgma wpgma neighbor joining advantage assume lineages evolve rate molecular clock hypothesis nevertheless neighbor joining largely superseded phylogenetic methods rely distance measures offer superior accuracy conditionscitation needed neighbor joining undesirable feature often assigns negative lengths branches many programs available implementing neighbor joining rapidnj ninja fast implementations typical run times proportional approximately square number taxa bionj weighbor variants neighbor joining improve accuracy making use fact shorter distances distance matrix generally better known longer distances fastme implementation closely related balanced minimum evolution method httpsenwikipediaorgwikineighborjoining